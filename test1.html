<!doctype html>
<html class="no-js" lang="en">
<head >
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, target-densitydpi=device-dpi" />
    <title>首页</title>
    <link rel="stylesheet" href="css/normalize.css" />
    <link rel="stylesheet" href="css/foundation.min.css" />
    <link rel="stylesheet" href="css/style.css" />
</head>
<body>
<button type="button" class="button" data-reveal-id="myModal">Click To Open Modal</button>

<div id="myModal" class="reveal-modal title-size" data-reveal>
    <a class="close-reveal-modal">&times;</a>
    <div class="message-content">
        <h3 class="yellow">填写个人信息：</h3>
        <div class="row">
            <span class="left white">姓名&nbsp;：&nbsp;</span>
            <input class="left" id="name" type="text" style="width: 30%;">
        </div>
        <div class="row">
            <span class="left white">联系电话&nbsp;：&nbsp;</span>
            <input class="left" id="number" type="text" style="width: 40%;">
        </div>
        <h3 class="yellow mt1rem">填写作品信息：</h3>
        <div class="row">
            <div id="type" class="select-btn">
                <span>组别</span>
                <ul class="dropdown">
                    <li>潮品</li>
                    <img src="img/quxian.png">
                    <li>车品</li>
                </ul>
            </div>
            <textarea rows="4" class="right" placeholder="作品描述（500字以内）" style="width: 70%;" ></textarea>
        </div>
        <div class="row text-center">
            <div id="uploader-demo">
                <!--用来存放item-->
                <div id="fileList" class="uploader-list"></div>
                <div id="filePicker">选择图片</div>
                <!--<button type="button" id="filePicker" class="button radius">上传以往作品</button>-->

            </div>
        </div>
        <div class="text-center">
            <button type="button" id="submit" class="button radius mr1rem">确认</button>
            <button type="button" class="button radius ml1rem">返回</button>
        </div>
    </div>
    <!--<div class="message-success">-->
        <!--<img src="img/success.png">-->
        <!--<p class="title-size yellow">上传成功，等待审核中......</p>-->
        <!--<img src="img/error.png">-->
        <!--<p class="title-size yellow">上传失败，请重新选择</p>-->
    <!--</div>-->
</div>
<!--<div id="uploader-demo">-->
    <!--&lt;!&ndash;用来存放item&ndash;&gt;-->
    <!--<div id="fileList" class="uploader-list"></div>-->
    <!--<div id="filePicker">选择图片</div>-->
<!--</div>-->

<script src="js/jquery.min.js"></script>
<script src="js/foundation.min.js"></script>
<script src="js/modernizr.js"></script>
<script src="js/webuploader.min.js"></script>

<script>
    var baseUrl="http://47.75.127.206:8080/"
    var uploadUrl = baseUrl+"image-server/uploadImage?mediaType=Picture&module=L";
    var imgUrl=baseUrl+"image-server/imageThumbnail?relUrl="
    jQuery(function () {
        var $ = jQuery,
            $list = $('#fileList'),
            // 优化retina, 在retina下这个值是2
            ratio = window.devicePixelRatio || 1,
            // 缩略图大小
            thumbnailWidth = 100 * ratio,
            thumbnailHeight = 100 * ratio,
            // Web Uploader实例
            uploader;

        // 初始化Web Uploader
        uploader = WebUploader.create({
            // 自动上传。
            auto: true,
            // 文件接收服务端。
            server: uploadUrl,
            // 选择文件的按钮。可选。
            // 内部根据当前运行是创建，可能是input元素，也可能是flash.
            pick: '#filePicker',
            // 只允许选择文件，可选。
            accept: {
                title: 'Images',
                extensions: 'gif,jpg,jpeg,bmp,png',
                mimeTypes: 'image/*'
            }
        });
        // 当有文件添加进来的时候
        uploader.on('fileQueued', function (file) {
            var $li = $(
                '<div id="' + file.id + '" class="file-item thumbnail">' +
                '<img>' +
                '<div class="info">' + file.name + '</div>' +
                '</div>'
                ),
                $img = $li.find('img');

            $list.append($li);

            // 创建缩略图
            uploader.makeThumb(file, function (error, src) {
                if (error) {
                    $img.replaceWith('<span>不能预览</span>');
                    return;
                }

                $img.attr('src', src);
            }, thumbnailWidth, thumbnailHeight);
        });

        // 文件上传过程中创建进度条实时显示。
        uploader.on('uploadProgress', function (file, percentage) {
            var $li = $('#' + file.id),
                $percent = $li.find('.progress span');

            // 避免重复创建
            if (!$percent.length) {
                $percent = $('<p class="progress"><span></span></p>')
                    .appendTo($li)
                    .find('span');
            }

            $percent.css('width', percentage * 100 + '%');
        });

        // 文件上传成功，给item添加成功class, 用样式标记上传成功。
        uploader.on('uploadSuccess', function (file, response) {
            console.log(response._raw);
            $('#' + file.id).addClass('upload-state-done');
        });

        // 文件上传失败，现实上传出错。
        uploader.on('uploadError', function (file) {
            var $li = $('#' + file.id),
                $error = $li.find('div.error');

            // 避免重复创建
            if (!$error.length) {
                $error = $('<div class="error"></div>').appendTo($li);
            }

            $error.text('上传失败');
        });

        // 完成上传完了，成功或者失败，先删除进度条。
        uploader.on('uploadComplete', function (file) {
            $('#' + file.id).find('.progress').remove();
        });
    });
    $(document).ready(function() {
        $(document).foundation({
            reveal: {
                close_on_background_click: false,
                close_on_esc: false
            }
        });
    })
    function DropDown(el) {
        this.dd   = el;
        this.span = this.dd.children('span');
        this.li   = this.dd.find('ul.dropdown li');
        this.val  = '';
    }
    DropDown.prototype.initEvents = function() {
        var obj = this;
        obj.dd.on('click', function(event){
            $(this).toggleClass('active').siblings().removeClass('active');
            event.stopPropagation();
        });
        obj.li.on('click', function() {
            var opt = $(this);
            obj.val = opt.html();
            if (obj.span.html() == obj.val) return;
            obj.span.html(obj.val);
            $(document).click(function() {
                $('.select-btn').removeClass('active');
            });
        })
    }
    new DropDown($('#type')).initEvents();
</script>
</body>
</html>
